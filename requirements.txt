import os
import logging
import sys

# Add library path first
sys.path.insert(0, '/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages')

# Configure logging
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(name)

# Import telegram modules
from telegram import Update, ReplyKeyboardMarkup
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes

# ØªÙˆÚ©Ù† Ø±Ø¨Ø§ØªØª Ø±Ùˆ Ø§Ø² Ù…ØªØºÛŒØ± Ù…Ø­ÛŒØ·ÛŒ ÛŒØ§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†
BOT_TOKEN = os.getenv("BOT_TOKEN", "YOUR_BOT_TOKEN_HERE")

# Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ùˆ
main_menu = [
    ["ğŸ“¦ Ø®Ø±ÛŒØ¯ Ø§Ø´ØªØ±Ø§Ú© Ø±Ø¨Ø§Øª", "ğŸ§ª ØªØ³Øª Ø±Ø§ÛŒÚ¯Ø§Ù† Ø±Ø¨Ø§Øª"],
    ["ğŸ¥ ÙˆÛŒØ¯ÛŒÙˆ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø±Ø¨Ø§Øª", "ğŸ“ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ"],
    ["ğŸ“˜ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡", "â“ Ø³ÙˆØ§Ù„Ø§Øª Ù…ØªØ¯Ø§ÙˆÙ„"]
]

# Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø«Ø§Ø¨Øª
welcome_text = "Ø³Ù„Ø§Ù… ğŸ‘‹\nØ¨Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø±Ø³Ù…ÛŒ MaxTraderr Ø®ÙˆØ´ Ø§ÙˆÙ…Ø¯ÛŒ âœ¨\nÙ„Ø·ÙØ§Ù‹ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù† ğŸ‘‡"

subscribe_text = """ğŸ’³ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø§Ø´ØªØ±Ø§Ú© Ø±Ø¨Ø§ØªØŒ Ù„Ø·ÙØ§Ù‹ ÛŒÚ©ÛŒ Ø§Ø² Ù¾Ù„Ù†â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:

1ï¸âƒ£ Ù…Ø§Ù‡Ø§Ù†Ù‡ - 49$
2ï¸âƒ£ Ø³Ù‡â€ŒÙ…Ø§Ù‡Ù‡ - 129$
3ï¸âƒ£ Ø´Ø´â€ŒÙ…Ø§Ù‡Ù‡ - 239$

Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ùˆ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø¨Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù¾ÛŒØ§Ù… Ø¨Ø¯Ù‡."""

trial_text = """ğŸ§ª Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª ØªØ³Øª Ø±Ø§ÛŒÚ¯Ø§Ù† Û· Ø±ÙˆØ²Ù‡:

Ú©Ø§ÙÛŒÙ‡ ÙÙ‚Ø· ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ù…ØªØ§ØªØ±ÛŒØ¯Ø± Ø±Ùˆ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒ Ø¨Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ØªØ§ Ø§Ú©Ø§Ù†Øª ØªØ³Øª Ø¨Ø±Ø§Øª ÙØ¹Ø§Ù„ Ø¨Ø´Ù‡ âœ¨"""

video_text = """ğŸ¥ Ø§ÛŒÙ† Ù‡Ù… ÙˆÛŒØ¯ÛŒÙˆÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø±Ø¨Ø§Øª Ù…Ø§:
https://t.me/maxtraderr/10"""

support_text = """ğŸ“ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ:
@MaxTraderrSupport"""

guide_text = """ğŸ“˜ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§Øª:

1ï¸âƒ£ ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù¾Ø±Øª Ø±Ùˆ Ø¯Ø§Ø®Ù„ Ù…ØªØ§ØªØ±ÛŒØ¯Ø± Ø¨Ø±ÛŒØ²
2ï¸âƒ£ Ø±ÙˆÛŒ Ú†Ø§Ø±Øª M1 ÛŒØ§ H1 Ø¨Ù†Ø¯Ø§Ø²
3ï¸âƒ£ Ø§Ø¬Ø§Ø²Ù‡ Ø¨Ø¯Ù‡ Ù…Ø¹Ø§Ù…Ù„Ù‡â€ŒÙ‡Ø§ Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ù†Ø¬Ø§Ù… Ø¨Ø´Ù†

Ø³ÙˆØ¯ Ùˆ Ø¶Ø±Ø± Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ú©Ù†ØªØ±Ù„ Ù…ÛŒØ´Ù‡."""

faq_text = """â“ Ø³ÙˆØ§Ù„Ø§Øª Ù…ØªØ¯Ø§ÙˆÙ„:

ğŸ’  Ø¢ÛŒØ§ Ø±Ø¨Ø§Øª Ø±ÙˆÛŒ Ù‡Ù…Ù‡â€ŒÛŒ Ø¨Ø±ÙˆÚ©Ø±Ù‡Ø§ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù‡ØŸ
â– Ø¨Ù„Ù‡ØŒ Ø±ÙˆÛŒ Ø§Ú©Ø«Ø± Ø¨Ø±ÙˆÚ©Ø±Ù‡Ø§ ØªØ³Øª Ø´Ø¯Ù‡.

ğŸ’  Ø¢ÛŒØ§ Ù†ÛŒØ§Ø² Ø¨Ù‡ VPS Ù‡Ø³ØªØŸ
â– Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…ÛŒØ´Ù‡ Ø¨Ø±Ø§ÛŒ Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ø¨Ù‡ØªØ±."""

help_text = """ğŸ¤– Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ MaxTraderr:

Ø¯Ø³ØªÙˆØ±Ø§Øª Ù…ÙˆØ¬ÙˆØ¯:
/start - Ø´Ø±ÙˆØ¹ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ
/help - Ù†Ù…Ø§ÛŒØ´ Ø§ÛŒÙ† Ø±Ø§Ù‡Ù†Ù…Ø§

Ø§Ø² Ù…Ù†ÙˆÛŒ Ø²ÛŒØ± Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:
â€¢ Ø®Ø±ÛŒØ¯ Ø§Ø´ØªØ±Ø§Ú© Ø±Ø¨Ø§Øª
â€¢ ØªØ³Øª Ø±Ø§ÛŒÚ¯Ø§Ù† Ø±Ø¨Ø§Øª
â€¢ ÙˆÛŒØ¯ÛŒÙˆ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø±Ø¨Ø§Øª
â€¢ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ
â€¢ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡
â€¢ Ø³ÙˆØ§Ù„Ø§Øª Ù…ØªØ¯Ø§ÙˆÙ„

Ø¨Ø±Ø§ÛŒ Ú©Ù…Ú© Ø¨ÛŒØ´ØªØ± Ø¨Ø§ @MaxTraderrSupport Ø¯Ø± ØªÙ…Ø§Ø³ Ø¨Ø§Ø´ÛŒØ¯."""

# Ø§Ø³ØªØ§Ø±Øª Ø±Ø¨Ø§Øª
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    try:
        user = update.effective_user
        logger.info(f"User {user.id} ({user.username}) started the bot")
        
        await update.message.reply_text(
            welcome_text, 
            reply_markup=ReplyKeyboardMarkup(main_menu, resize_keyboard=True)
        )
    except Exception as e:
        logger.error(f"Error in start command: {e}")
        await update.message.reply_text("Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.")

# Ø±Ø§Ù‡Ù†Ù…Ø§
async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    try:
        await update.message.reply_text(
            help_text,
            reply_markup=ReplyKeyboardMarkup(main_menu, resize_keyboard=True)
        )
    except Exception as e:
        logger.error(f"Error in help command: {e}")
        await update.message.reply_text("Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.")# Ù‡Ù†Ø¯Ù„ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    try:
        text = update.message.text.strip()
        user = update.effective_user
        
        logger.info(f"User {user.id} ({user.username}) sent: {text}")
        
        if text == "ğŸ“¦ Ø®Ø±ÛŒØ¯ Ø§Ø´ØªØ±Ø§Ú© Ø±Ø¨Ø§Øª":
            await update.message.reply_text(subscribe_text)
        elif text == "ğŸ§ª ØªØ³Øª Ø±Ø§ÛŒÚ¯Ø§Ù† Ø±Ø¨Ø§Øª":
            await update.message.reply_text(trial_text)
        elif text == "ğŸ¥ ÙˆÛŒØ¯ÛŒÙˆ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø±Ø¨Ø§Øª":
            await update.message.reply_text(video_text)
        elif text == "ğŸ“ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ":
            await update.message.reply_text(support_text)
        elif text == "ğŸ“˜ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡":
            await update.message.reply_text(guide_text)
        elif text == "â“ Ø³ÙˆØ§Ù„Ø§Øª Ù…ØªØ¯Ø§ÙˆÙ„":
            await update.message.reply_text(faq_text)
        else:
            await update.message.reply_text(
                "Ø¯Ø³ØªÙˆØ± Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨ÙˆØ¯. Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ù…Ù†ÙˆÛŒ Ø²ÛŒØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù† ğŸ‘‡", 
                reply_markup=ReplyKeyboardMarkup(main_menu, resize_keyboard=True)
            )
    except Exception as e:
        logger.error(f"Error handling message: {e}")
        await update.message.reply_text("Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.")

# Ù‡Ù†Ø¯Ù„ Ø®Ø·Ø§Ù‡Ø§
async def error_handler(update: object, context: ContextTypes.DEFAULT_TYPE):
    logger.error(f"Exception while handling an update: {context.error}")
    
    if isinstance(update, Update) and update.message:
        try:
            await update.message.reply_text("Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.")
        except Exception:
            pass

# Ø§Ø¬Ø±Ø§ÛŒ Ø±Ø¨Ø§Øª
def main():
    # Ø¨Ø±Ø±Ø³ÛŒ ØªÙˆÚ©Ù†
    if not BOT_TOKEN or BOT_TOKEN == "7951072696:AAEmDDiXpnxgdTG6ZbBMTYCXgLYyeCqKlBA"
        print("âŒ Error: Bot token is not set!")
        print("Please set BOT_TOKEN environment variable or edit the bot_working.py file")
        print("To get a bot token:")
        print("1. Go to @BotFather on Telegram")
        print("2. Use /newbot command")
        print("3. Follow the instructions")
        print("4. Copy the token and set it as BOT_TOKEN environment variable")
        return
    
    try:
        # Ø§ÛŒØ¬Ø§Ø¯ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†
        app = Application.builder().token(BOT_TOKEN).build()

        # Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù‡Ù†Ø¯Ù„Ø±Ù‡Ø§
        app.add_handler(CommandHandler("start", start))
        app.add_handler(CommandHandler("help", help_command))
        app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
        app.add_error_handler(error_handler)

        print("ğŸ¤– MaxTraderr Support Bot is starting...")
        print("âœ… Bot is running and ready to receive messages!")
        print()
        print("ğŸ’¡ To set profile photo manually:")
        print("   1. Go to @BotFather on Telegram")
        print("   2. Send /setuserpic command")
        print("   3. Select your bot")
        print("   4. Send the logo image file")
        print()
        
        # Ø§Ø¬Ø±Ø§ÛŒ Ø±Ø¨Ø§Øª
        app.run_polling()
        
    except Exception as e:
        logger.error(f"Fatal error: {e}")
        print(f"âŒ Error starting bot: {e}")

if name == "main":
    main()
